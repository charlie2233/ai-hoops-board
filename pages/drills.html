<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>训练库</title>
<style>
  :root{--accent:#FF7A1A;--border:#E5E7EB}
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,"PingFang SC",Arial}
  .appbar{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--border);
    padding:12px 16px;display:flex;gap:12px;align-items:center;z-index:10}
  .appbar a{color:#111;text-decoration:none}
  h1{font-size:18px;margin:0}
  .filters{display:flex;gap:8px;padding:8px 12px;border-bottom:1px solid var(--border)}
  select,input{height:38px;border:1px solid var(--border);border-radius:8px;padding:0 10px}
  input{flex:1}
  .list{padding:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:12px}
  .card{border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff;display:flex;gap:12px}
  .thumb{width:160px;height:90px;border:1px solid var(--border);border-radius:8px;overflow:hidden;background:#fafafa;
         display:flex;align-items:center;justify-content:center;color:#64748B;font-size:12px}
  .title{font-weight:700}
  .meta{font-size:12px;color:#64748B}
  .btn{margin-top:8px;height:38px;border-radius:10px;border:1px solid var(--accent);background:var(--accent);color:#fff;padding:0 10px}
</style>
</head>
<body>
  <div class="appbar">
    <a href="../index.html">← 画板</a>
    <h1>训练库</h1>
  </div>

  <div class="filters">
    <input id="q" placeholder="搜索训练/要点/标签…"/>
    <select id="fPlay"><option value="">关联战术</option></select>
  </div>

  <div class="list" id="list"></div>

<script>
let drills=[], plays=[];
async function load(){
  plays = await (await fetch('../plays/plays.json')).json();
  drills = await (await fetch('../drills/drills.json')).json();

  // 绑定“关联战术”下拉
  const sel = document.getElementById('fPlay');
  plays.forEach(p=>{
    const op = document.createElement('option');
    op.value = p.id; op.textContent = p.name;
    sel.appendChild(op);
  });
  render();
}
function match(d,q,pid){
  const text = (d.title+' '+(d.notes||'')+' '+(d.tags||[]).join(' ')).toLowerCase();
  const qok = !q || text.includes(q.toLowerCase());
  const pok = !pid || d.playId===pid;
  return qok && pok;
}
function ytThumb(id){
  if(!id || id.startsWith('VIDEO_ID_')) return '';
  return `https://i.ytimg.com/vi/${id}/hqdefault.jpg`;
}
function render(){
  const q = document.getElementById('q').value.trim();
  const pid = document.getElementById('fPlay').value;
  const list = document.getElementById('list');
  list.innerHTML = drills.filter(d=>match(d,q,pid)).map(d=>{
    const thumb = ytThumb(d.youtubeId);
    const playName = (plays.find(p=>p.id===d.playId)||{}).name || d.playId;
    return `
      <div class="card">
        <div class="thumb">
          ${thumb ? `<img src="${thumb}" alt="" style="width:100%;height:100%;object-fit:cover"/>` : '占位缩略图'}
        </div>
        <div style="flex:1">
          <div class="title">${d.title}</div>
          <div class="meta">${d.duration||''} · 关联：${playName} · 标签：${(d.tags||[]).join('/')}</div>
          <div class="meta">要点：${d.notes||''}</div>
          <button class="btn" onclick="play('${d.youtubeId}')">▶ 播放</button>
        </div>
      </div>`;
  }).join('') || '<div style="color:#64748B">没有匹配的训练</div>';
}
function play(id){
  if(!id || id.startsWith('VIDEO_ID_')) { alert('占位ID，请替换为真实的 YouTube 视频ID'); return; }
  window.open(`https://www.youtube.com/watch?v=${id}`, '_blank');
}
document.getElementById('q').oninput = render;
document.getElementById('fPlay').onchange = render;
load();
</script>
</body>
</html>

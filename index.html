<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>AI æˆ˜æœ¯æ¿ Â· MVP</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f4f7ff"/>
  <link rel="apple-touch-icon" href="assets/icon-192.png">
  <script>
    (() => {
      try {
        const t = localStorage.getItem('uiThemeV1');
        if (t === 'light' || t === 'dark') document.documentElement.setAttribute('data-theme', t);
        const s = localStorage.getItem('uiThemeStyleV1');
        if (s === 'classic' || s === 'vivid') document.documentElement.setAttribute('data-style', s);
        const l = localStorage.getItem('uiLangV1');
        if (l === 'zh' || l === 'en') document.documentElement.setAttribute('data-lang', l);
      } catch (_) {}
    })();
  </script>
  <style>
    :root {
      --bg: #f4f7ff;
      --bg-soft: #eef2ff;
      --panel: rgba(255,255,255,.74);
      --panel-strong: rgba(255,255,255,.88);
      --text: #0f172a;
      --muted: #64748b;
      --line: #d7dff3;
      --line-strong: #c1cae4;
      --accent: #ea580c;
      --accent-soft: #fb923c;
      --tap: 48px;
      --radius: 14px;
      --shadow: 0 14px 34px rgba(15,23,42,.08);
      --ai-h: 48px;
      --canvas-bg: #ffffff;
      --btn-text: #0f172a;
      --hint-bg: #fff7ed;
      --hint-text: #9a3412;
      --font-main: "Avenir Next", "Trebuchet MS", "Segoe UI", "PingFang SC", "Noto Sans SC", sans-serif;
      --font-title: "Avenir Next Condensed", "Trebuchet MS", "PingFang SC", sans-serif;
    }

    :root[data-theme="dark"] {
      --bg: #0b1220;
      --bg-soft: #111a2d;
      --panel: rgba(15,23,42,.72);
      --panel-strong: rgba(15,23,42,.9);
      --text: #e2e8f0;
      --muted: #94a3b8;
      --line: #25324d;
      --line-strong: #3a4a6b;
      --accent: #fb923c;
      --accent-soft: #f97316;
      --shadow: 0 18px 42px rgba(2,6,23,.44);
      --canvas-bg: #0e1728;
      --btn-text: #e2e8f0;
      --hint-bg: rgba(30,41,59,.66);
      --hint-text: #fed7aa;
    }

    :root[data-style="vivid"] {
      --bg: #fff8ef;
      --bg-soft: #ffe9d6;
      --panel: rgba(255,250,243,.8);
      --panel-strong: rgba(255,250,243,.93);
      --text: #1f2937;
      --muted: #7c5c3d;
      --line: #f2c7a7;
      --line-strong: #e8a87f;
      --accent: #0f766e;
      --accent-soft: #14b8a6;
      --shadow: 0 14px 34px rgba(15,118,110,.14);
      --canvas-bg: #fffdfa;
      --btn-text: #1f2937;
      --hint-bg: #ecfeff;
      --hint-text: #155e75;
    }

    :root[data-theme="dark"][data-style="vivid"] {
      --bg: #0f172a;
      --bg-soft: #111827;
      --panel: rgba(17,24,39,.78);
      --panel-strong: rgba(17,24,39,.92);
      --text: #ecfeff;
      --muted: #93c5fd;
      --line: #234059;
      --line-strong: #2f5f87;
      --accent: #14b8a6;
      --accent-soft: #2dd4bf;
      --shadow: 0 18px 42px rgba(15,118,110,.3);
      --canvas-bg: #0b1220;
      --btn-text: #ecfeff;
      --hint-bg: rgba(8,47,73,.5);
      --hint-text: #67e8f9;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    html, body {
      margin: 0;
      height: 100%;
      font-family: var(--font-main);
      color: var(--text);
      background:
        radial-gradient(1200px 620px at -8% -15%, color-mix(in srgb, var(--accent-soft) 30%, transparent), transparent 65%),
        radial-gradient(980px 560px at 110% -20%, color-mix(in srgb, #22c55e 20%, transparent), transparent 70%),
        linear-gradient(165deg, var(--bg), var(--bg-soft));
      background-attachment: fixed;
    }

    body::before,
    body::after {
      content: "";
      position: fixed;
      inset: auto;
      width: 360px;
      height: 360px;
      border-radius: 50%;
      pointer-events: none;
      z-index: -1;
      filter: blur(34px);
      opacity: .42;
      animation: drift 14s ease-in-out infinite;
    }

    body::before {
      left: -120px;
      bottom: 12vh;
      background: color-mix(in srgb, var(--accent) 35%, transparent);
    }

    body::after {
      right: -140px;
      top: 16vh;
      background: color-mix(in srgb, #06b6d4 30%, transparent);
      animation-delay: -7s;
    }

    @keyframes drift {
      0% { transform: translateY(0) scale(1); }
      50% { transform: translateY(-18px) scale(1.05); }
      100% { transform: translateY(0) scale(1); }
    }

    .appbar {
      position: sticky;
      top: 0;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 10px 14px;
      border-bottom: 1px solid var(--line);
      background: color-mix(in srgb, var(--panel-strong) 92%, transparent);
      backdrop-filter: blur(8px);
    }

    .appbar h1 {
      margin: 0;
      font: 700 20px/1.1 var(--font-title);
      letter-spacing: .2px;
    }

    .app-sub {
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
    }

    .appbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .badge {
      padding: 6px 9px;
      border-radius: 999px;
      font-size: 11px;
      color: var(--muted);
      border: 1px solid var(--line);
      background: color-mix(in srgb, var(--panel) 78%, transparent);
    }

    .icon-btn {
      min-width: 44px !important;
      font-size: 18px;
      padding: 0 10px;
    }

    .more-btn {
      min-width: 80px;
    }

    .theme-switch, .style-switch, .lang-switch {
      display: none;
    }

    .toolbar {
      position: sticky;
      top: 50px;
      z-index: 19;
      display: flex;
      gap: 6px;
      padding: 8px 12px;
      border-bottom: 1px solid var(--line);
      background: color-mix(in srgb, var(--panel) 90%, transparent);
      backdrop-filter: blur(7px);
      overflow-x: auto;
      white-space: nowrap;
      scrollbar-width: none;
    }

    .toolbar::-webkit-scrollbar { display: none; }

    .toolbar .btn,
    .toolbar .player-select {
      flex: 0 0 auto;
    }

    .advanced-toolbar {
      position: sticky;
      top: 106px;
      z-index: 18;
      display: none;
      gap: 6px;
      padding: 8px 12px;
      border-bottom: 1px solid var(--line);
      background: color-mix(in srgb, var(--panel) 85%, transparent);
      backdrop-filter: blur(7px);
      overflow-x: auto;
      white-space: nowrap;
      scrollbar-width: none;
    }

    .advanced-toolbar::-webkit-scrollbar { display: none; }

    .advanced-toolbar.show {
      display: flex;
    }

    .btn,
    .player-select,
    #speed {
      height: 42px;
      border-radius: var(--radius);
      border: 1px solid var(--line);
      background: color-mix(in srgb, var(--panel-strong) 88%, transparent);
      color: var(--btn-text);
      font-size: 13px;
      font-weight: 700;
      transition: transform .18s ease, border-color .18s ease, background .18s ease, color .18s ease;
    }

    .btn {
      min-width: 90px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 0 12px;
      box-shadow: var(--shadow);
      cursor: pointer;
    }

    a.btn {
      text-decoration: none;
    }

    .btn:hover,
    .player-select:hover,
    #speed:hover {
      border-color: var(--line-strong);
      transform: translateY(-1px);
    }

    .btn.primary {
      color: #fff;
      border-color: transparent;
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
      box-shadow: 0 10px 20px color-mix(in srgb, var(--accent) 34%, transparent);
    }

    .btn.active {
      border-color: var(--accent-soft);
      outline: 0;
      box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent-soft) 30%, transparent), var(--shadow);
    }

    .player-select {
      min-width: 132px;
      padding: 0 10px;
      box-shadow: var(--shadow);
      appearance: none;
      background-image:
        linear-gradient(45deg, transparent 50%, var(--muted) 50%),
        linear-gradient(135deg, var(--muted) 50%, transparent 50%);
      background-position:
        calc(100% - 16px) calc(50% - 3px),
        calc(100% - 10px) calc(50% - 3px);
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
      padding-right: 24px;
    }

    #quick-play {
      min-width: 168px;
    }

    .replaybar {
      position: sticky;
      top: 106px;
      z-index: 18;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-bottom: 1px solid var(--line);
      background: color-mix(in srgb, var(--panel) 90%, transparent);
      backdrop-filter: blur(7px);
    }

    .replaybar .btn {
      min-width: 92px;
      height: 42px;
      font-size: 12px;
    }

    #seek {
      flex: 1;
      height: 42px;
      appearance: none;
      border-radius: 999px;
      background: color-mix(in srgb, var(--line) 80%, transparent);
      border: 1px solid var(--line);
    }

    #seek::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 0;
      background: linear-gradient(135deg, var(--accent), var(--accent-soft));
    }

    #speed {
      min-width: 112px;
      padding: 0 8px;
    }

    .ai-strip {
      margin: 8px 12px 0;
      min-height: 40px;
      padding: 8px 12px;
      border-radius: var(--radius);
      border: 1px solid color-mix(in srgb, var(--accent) 35%, var(--line));
      background: var(--hint-bg);
      color: var(--hint-text);
      font-size: 12px;
      font-weight: 600;
      line-height: 1.35;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
    }

    .board-wrap {
      margin: 8px 12px 0;
      padding: 8px;
      border: 1px solid var(--line);
      border-radius: 18px;
      background: color-mix(in srgb, var(--panel) 90%, transparent);
      box-shadow: var(--shadow);
    }

    canvas {
      width: 100%;
      height: auto;
      max-height: calc(100vh - 220px);
      aspect-ratio: 1080 / 1600;
      border: 1px solid var(--line);
      border-radius: 14px;
      touch-action: none;
      background: var(--canvas-bg);
    }

    .hint {
      margin-top: 6px;
      padding: 6px 10px;
      font-size: 11px;
      color: var(--muted);
      border-radius: 10px;
      border: 1px dashed var(--line);
      background: color-mix(in srgb, var(--panel) 85%, transparent);
    }

    .bottombar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 22;
      display: flex;
      gap: 6px;
      padding: 8px 12px calc(8px + env(safe-area-inset-bottom));
      border-top: 1px solid var(--line);
      background: color-mix(in srgb, var(--panel-strong) 94%, transparent);
      backdrop-filter: blur(10px);
    }

    .bottombar .btn { min-width: 0; flex: 1; }

    @media (max-width: 860px) {
      .badge { display: none; }
      .app-sub { display: none; }
      .appbar h1 { font-size: 17px; }
    }

    @media (min-width: 861px) and (max-width: 1024px) {
      canvas { 
        max-height: calc(100vh - 200px);
      }
    }

    @media (min-width: 1025px) {
      canvas { 
        max-height: calc(100vh - 180px);
      }
    }
  </style>
</head>
<body>
  <div class="appbar">
    <div>
      <h1 id="app-title">AI æˆ˜æœ¯æ¿</h1>
      <div class="app-sub" id="app-sub">Basketball Play Designer</div>
    </div>
    <div class="appbar-right">
      <a class="btn icon-btn" id="link-settings" href="pages/settings.html" title="è®¾ç½®">âš™ï¸</a>
      <a class="btn icon-btn" id="link-library" href="pages/library.html" title="æˆ˜æœ¯åº“">ğŸ“š</a>
      <a class="btn icon-btn" id="link-drills" href="pages/drills.html" title="è®­ç»ƒ">ğŸ¯</a>
    </div>
  </div>

  <div class="toolbar">
    <button class="btn" id="mode-drag">æ‹–æ‹½</button>
    <button class="btn" id="mode-run">è·‘ä½çº¿</button>
    <button class="btn" id="mode-pass">ä¼ çƒç®­å¤´</button>
    <button class="btn" id="undo">æ’¤é”€</button>
    <button class="btn" id="redo">é‡åš</button>
    <button class="btn" id="erase">æ©¡çš®æ“¦</button>
    <button class="btn" id="toggle-court">åˆ‡æ¢åŠåœº/å…¨åœº</button>
    <button class="btn" id="toggle-defense" aria-pressed="false">ç§»é™¤é˜²å®ˆ</button>
    <button class="btn more-btn" id="show-advanced">æ›´å¤š â–¼</button>
  </div>

  <div class="advanced-toolbar" id="advanced-toolbar">
    <select id="offense-player" class="player-select" aria-label="æŒçƒäººé€‰æ‹©">
      <option value="1">æŒçƒäººï¼š1</option>
      <option value="2">æŒçƒäººï¼š2</option>
      <option value="3">æŒçƒäººï¼š3</option>
      <option value="4">æŒçƒäººï¼š4</option>
      <option value="5">æŒçƒäººï¼š5</option>
    </select>
    <select id="quick-play" class="player-select" aria-label="å¿«é€Ÿæˆ˜æœ¯">
      <option value="">å¿«é€Ÿæˆ˜æœ¯ï¼šé€‰æ‹©</option>
    </select>
    <button class="btn" id="random-play">éšæœºæˆ˜æœ¯</button>
    <button class="btn" id="reset-view">é‡ç½®è§†å›¾</button>
    <button class="btn" id="play">å›æ”¾</button>
  </div>

  <div class="replaybar" id="replaybar" style="display: none;">
    <button class="btn" id="btn-playpause">å›æ”¾</button>
    <button class="btn" id="btn-stop">åœæ­¢</button>
    <input id="seek" type="range" min="0" max="100" step="0.1" value="0" />
    <select id="speed">
      <option value="0.5">0.5Ã—</option>
      <option value="0.75" selected>0.75Ã— é»˜è®¤</option>
      <option value="1">1Ã—</option>
      <option value="2">2Ã—</option>
    </select>
  </div>

  <div class="ai-strip" id="ai-strip">AI æç¤ºï¼šæ­£åœ¨åˆ†æå½“å‰ç«™ä½â€¦</div>

  <div class="board-wrap">
    <canvas id="board" width="1080" height="1600"></canvas>
    <div class="hint" id="board-hint">æ‰‹æŒ‡æ‹–åŠ¨åœ†ç‚¹ç§»åŠ¨çƒå‘˜ï¼›åœ¨â€œè·‘ä½çº¿/ä¼ çƒç®­å¤´â€æ¨¡å¼ä¸‹æ‹–åŠ¨ç»˜åˆ¶ï¼›å¯ä¸€é”®ç§»é™¤/æ¢å¤é˜²å®ˆï¼›åŒæŒ‡å¯ç¼©æ”¾/å¹³ç§»ç”»æ¿ï¼›æ”¯æŒæ’¤é”€/é‡åšä¸å¯¼å‡º PNGã€‚</div>
  </div>

  <div class="bottombar">
    <button class="btn" id="clear">æ¸…ç©º</button>
    <button class="btn" id="save">ä¿å­˜</button>
    <button class="btn" id="load">è½½å…¥</button>
    <button class="btn primary" id="export">å¯¼å‡º PNG</button>
  </div>

  <script type="module" src="main.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js');
      });
    }
  </script>
</body>
</html>

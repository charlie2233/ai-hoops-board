// plays/presets.js
// 0..1 归一化几何预设（半场），用于 Library→Board 一键应用兜底
// 提供：getPreset(id)；若请求 horns_R / horns_flare_R 且未定义，自动 mirrorX(对应 _L)

function p(x, y) { return { x, y }; }

// —— 镜像工具（沿竖直中线镜像 X 坐标）——
function mirrorXPoint(pt) { return { x: 1 - pt.x, y: pt.y }; }
function mirrorX(geom) {
  if (!geom) return null;
  const m = (arr = []) => arr.map(mirrorXPoint);
  const ms = (shapes = []) => shapes.map(s => ({
    type: s.type,
    pts: (s.pts || []).map(mirrorXPoint)
  }));
  return {
    court: geom.court,
    ballHandler: geom.ballHandler,
    offense: m(geom.offense),
    defense: m(geom.defense),
    shapes:  ms(geom.shapes)
  };
}

/** =========================
 * fiveOut（默认兜底）
 * 顶弧 + 两侧45 + 两底角；不预设线路，留给教练自由画
 * ========================= */
const fiveOut = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.5, 0.35), // 1 顶弧
    p(0.72, 0.48), // 2 右45
    p(0.28, 0.48), // 3 左45
    p(0.82, 0.78), // 4 右底角
    p(0.18, 0.78)  // 5 左底角
  ],
  defense: [
    p(0.5, 0.32),
    p(0.68, 0.41),
    p(0.32, 0.41),
    p(0.78, 0.67),
    p(0.22, 0.67)
  ],
  shapes: []
};

/** =========================
 * Horns Left PnR（标准 5 设置右肘位掩护，1 往左用掩护，5 顺下）
 * - 4 左肘，5 右肘
 * - 1 用 5 的掩护向左肘方向推进
 * - 5 顺下，1 传 5
 * ========================= */
const horns_L = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.5, 0.35), // 1 顶弧
    p(0.2, 0.78), // 2 左底角牵制（稍更深以拉开）
    p(0.8, 0.78), // 3 右底角牵制
    p(0.38, 0.63), // 4 左肘
    p(0.62, 0.63)  // 5 右肘（设掩）
  ],
  defense: [
    p(0.5, 0.32),
    p(0.26, 0.67),
    p(0.74, 0.67),
    p(0.42, 0.56),
    p(0.58, 0.56)
  ],
  shapes: [
    // 1 运用 5 的掩护向左推进
    { type: 'run',  pts: [p(0.5, 0.35), p(0.46, 0.33), p(0.42, 0.31), p(0.38, 0.30)] },
    // 5 顺下（务必给 5 的 RUN，使回放引擎关联到 5）
    { type: 'run',  pts: [p(0.62, 0.63), p(0.58, 0.78), p(0.54, 0.84), p(0.52, 0.88)] },
    // 1 → 5 传球（顺下到篮筐附近）
    { type: 'pass', pts: [p(0.38, 0.30), p(0.52, 0.88)] }
  ]
};

/** =========================
 * Spain PnR（2 背掩 5，5 顺下；2 外弹）
 * - 5 高位设掩护；2 从背后给 5 背掩 → 外弹到右45
 * - 1 传 5（顺下）
 * ========================= */
const spain = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.52, 0.37), // 1 顶弧偏右
    p(0.36, 0.48), // 2 左45 将去背掩
    p(0.78, 0.78), // 3 右底角
    p(0.22, 0.78), // 4 左底角
    p(0.56, 0.67)  // 5 高位/罚球线附近
  ],
  defense: [
    p(0.5, 0.32),
    p(0.4, 0.44),
    p(0.72, 0.67),
    p(0.28, 0.67),
    p(0.56, 0.56)
  ],
  shapes: [
    // 2 上提背掩 5 → 外弹到右45
    { type: 'run',  pts: [p(0.36, 0.48), p(0.5, 0.63), p(0.64, 0.41)] },
    // 5 顺下
    { type: 'run',  pts: [p(0.56, 0.67), p(0.54, 0.82), p(0.52, 0.90)] },
    // 1 → 5 的顺下传球
    { type: 'pass', pts: [p(0.52, 0.37), p(0.52, 0.90)] }
  ]
};

/** =========================
 * Pistol（侧翼手递手 + Step-up）
 * - 1 把球运到右侧45；2 从右底角上提接手递手
 * - 5 上提做 step-up 掩护给 2，5 再短顺（或深顺）
 * - 示例包含：1→2 的 DHO（用 pass 表达），2→5 的顺下传球
 * ========================= */
const pistol = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.5, 0.35), // 1 顶弧
    p(0.84, 0.80), // 2 右底角
    p(0.18, 0.78), // 3 左底角牵制
    p(0.3, 0.67), // 4 左肘牵制/弱侧
    p(0.56, 0.67)  // 5 高位
  ],
  defense: [
    p(0.5, 0.32),
    p(0.78, 0.74),
    p(0.22, 0.67),
    p(0.34, 0.59),
    p(0.56, 0.56)
  ],
  shapes: [
    // 1 运到右45
    { type: 'run',  pts: [p(0.5, 0.35), p(0.66, 0.44)] },
    // 2 上提接手递手点
    { type: 'run',  pts: [p(0.84, 0.80), p(0.7, 0.50), p(0.66, 0.44)] },
    // 1 → 2（手递手用 pass 表示）
    { type: 'pass', pts: [p(0.66, 0.44), p(0.66, 0.44)] },
    // 5 上提 step-up → 顺下
    { type: 'run',  pts: [p(0.56, 0.67), p(0.62, 0.56), p(0.6, 0.82)] },
    // 2 → 5 顺下传球
    { type: 'pass', pts: [p(0.66, 0.44), p(0.6, 0.82)] }
  ]
};

/** =========================
 * Chicago（Pin-down → 接球 → 可接 DHO）
 * - 3 从左底角经 pin-down（用线路表示）上提到左45/顶弧
 * - 1 传 3，形成快速投篮或二次手递手
 * ========================= */
const chicago = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.52, 0.37), // 1 顶弧偏右
    p(0.82, 0.78), // 2 右底角牵制
    p(0.18, 0.80), // 3 左底角（受 pin-down 的人）
    p(0.34, 0.67), // 4 左侧挡人/掩护者（示意位置）
    p(0.6, 0.67)  // 5 高位/中轴
  ],
  defense: [
    p(0.5, 0.32),
    p(0.78, 0.71),
    p(0.22, 0.74),
    p(0.38, 0.59),
    p(0.6, 0.56)
  ],
  shapes: [
    // 3 经 pin-down 上提到左45 - 顶弧
    { type: 'run',  pts: [p(0.18, 0.80), p(0.28, 0.59), p(0.36, 0.44), p(0.44, 0.34)] },
    // 1 → 3 传球（形成快速出手/二次进攻）
    { type: 'pass', pts: [p(0.52, 0.37), p(0.44, 0.34)] }
  ]
};

/** =========================
 * Horns Flare Left（Horns 变体：4 给 2 做 Flare，1 可先用 5 掩护）
 * - 2 从左底角外弹到左翼/左45；4 提前到左肘做 flare 角度
 * - 1 也可先轻用 5 的掩护进入中路，再转移给 2
 * ========================= */
const horns_flare_L = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.5, 0.35), // 1 顶弧
    p(0.18, 0.80), // 2 左底角
    p(0.82, 0.78), // 3 右底角
    p(0.38, 0.63), // 4 左肘（flare 角度）
    p(0.62, 0.63)  // 5 右肘
  ],
  defense: [
    p(0.5, 0.32),
    p(0.24, 0.74),
    p(0.78, 0.71),
    p(0.42, 0.56),
    p(0.58, 0.56)
  ],
  shapes: [
    // 2 外弹到左翼/左45
    { type: 'run',  pts: [p(0.18, 0.80), p(0.24, 0.63), p(0.34, 0.48)] },
    // 1 轻用 5 的掩护靠中路（可选，给回放更自然）
    { type: 'run',  pts: [p(0.5, 0.35), p(0.56, 0.33), p(0.5, 0.32)] },
    // 1 → 2 转移
    { type: 'pass', pts: [p(0.5, 0.32), p(0.34, 0.48)] }
  ]
};

/** =========================
 * Double Drag（双掩护推进）
 * - 4 先掩后外弹，5 后掩顺下
 * - 1 借双掩护攻击中路
 * ========================= */
const double_drag = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.5, 0.37), // 1 顶弧
    p(0.18, 0.80), // 2 左底角
    p(0.82, 0.80), // 3 右底角
    p(0.44, 0.63), // 4 先掩
    p(0.58, 0.67)  // 5 后掩
  ],
  defense: [
    p(0.5, 0.32),
    p(0.24, 0.74),
    p(0.76, 0.74),
    p(0.42, 0.56),
    p(0.58, 0.56)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.5, 0.37), p(0.56, 0.34), p(0.62, 0.34), p(0.68, 0.34)] }, // 1 攻击中路
    { type: 'run',  pts: [p(0.44, 0.63), p(0.5, 0.52), p(0.6, 0.44)] },                 // 4 外弹
    { type: 'run',  pts: [p(0.58, 0.67), p(0.56, 0.82), p(0.54, 0.90)] },                 // 5 顺下
    { type: 'pass', pts: [p(0.68, 0.34), p(0.54, 0.90)] }                                 // 1 → 5
  ]
};

/** =========================
 * Ghost PnR（假掩护外弹）
 * ========================= */
const ghost = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.5, 0.35),
    p(0.22, 0.80),
    p(0.8, 0.78),
    p(0.6, 0.56), // 4 假掩
    p(0.34, 0.67)
  ],
  defense: [
    p(0.5, 0.32),
    p(0.28, 0.74),
    p(0.74, 0.71),
    p(0.58, 0.48),
    p(0.38, 0.59)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.6, 0.56), p(0.66, 0.44), p(0.72, 0.41)] }, // 4 外弹
    { type: 'run',  pts: [p(0.5, 0.35), p(0.46, 0.32), p(0.42, 0.30)] }, // 1 突分威胁
    { type: 'pass', pts: [p(0.42, 0.30), p(0.72, 0.41)] }                  // 1 → 4
  ]
};

/** =========================
 * Floppy（绕双掩护）
 * ========================= */
const floppy = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.5, 0.35),
    p(0.5, 0.84), // 2 射手起点
    p(0.82, 0.74),
    p(0.4, 0.74), // 4 掩护
    p(0.6, 0.74)  // 5 掩护
  ],
  defense: [
    p(0.5, 0.32),
    p(0.5, 0.78),
    p(0.76, 0.67),
    p(0.42, 0.67),
    p(0.58, 0.67)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.5, 0.84), p(0.38, 0.71), p(0.3, 0.52), p(0.26, 0.41)] }, // 2 绕出
    { type: 'pass', pts: [p(0.5, 0.35), p(0.26, 0.41)] }                                 // 1 → 2
  ]
};

/** =========================
 * Elevator（电梯门）
 * ========================= */
const elevator = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.5, 0.37),
    p(0.5, 0.84), // 2 穿门
    p(0.8, 0.74),
    p(0.44, 0.63), // 4 门左
    p(0.56, 0.63)  // 5 门右
  ],
  defense: [
    p(0.5, 0.32),
    p(0.5, 0.78),
    p(0.74, 0.67),
    p(0.44, 0.56),
    p(0.56, 0.56)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.5, 0.84), p(0.5, 0.71), p(0.5, 0.48), p(0.5, 0.34)] }, // 2 穿门到顶弧
    { type: 'pass', pts: [p(0.5, 0.37), p(0.5, 0.34)] }                                 // 1 → 2
  ]
};

/** =========================
 * Hammer（弱侧底角）
 * ========================= */
const hammer = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.46, 0.37), // 1
    p(0.84, 0.80), // 2 底角终结点
    p(0.24, 0.78), // 3
    p(0.62, 0.74), // 4 弱侧掩护
    p(0.4, 0.67)  // 5
  ],
  defense: [
    p(0.46, 0.32),
    p(0.78, 0.74),
    p(0.28, 0.67),
    p(0.6, 0.67),
    p(0.4, 0.56)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.46, 0.37), p(0.56, 0.44), p(0.7, 0.56), p(0.84, 0.67)] }, // 1 底线突破
    { type: 'run',  pts: [p(0.62, 0.74), p(0.72, 0.78), p(0.78, 0.80)] },                 // 4 去设 hammer
    { type: 'pass', pts: [p(0.84, 0.67), p(0.84, 0.80)] }                                 // 1 → 2 底角
  ]
};

/** =========================
 * Princeton Chin（高位轴心）
 * ========================= */
const princeton = {
  court: 'half',
  ballHandler: '5',
  offense: [
    p(0.42, 0.44), // 1
    p(0.64, 0.44), // 2
    p(0.82, 0.78), // 3
    p(0.18, 0.78), // 4
    p(0.5, 0.59)  // 5 高位轴心
  ],
  defense: [
    p(0.42, 0.34),
    p(0.64, 0.34),
    p(0.76, 0.67),
    p(0.24, 0.67),
    p(0.5, 0.48)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.42, 0.44), p(0.46, 0.59), p(0.5, 0.80), p(0.52, 0.90)] }, // 1 背切
    { type: 'run',  pts: [p(0.64, 0.44), p(0.7, 0.37), p(0.76, 0.34)] },                 // 2 外弹
    { type: 'pass', pts: [p(0.5, 0.59), p(0.52, 0.90)] },                                // 5 → 1
    { type: 'pass', pts: [p(0.52, 0.90), p(0.76, 0.34)] }                                 // 1 → 2
  ]
};

/** =========================
 * BLOB Box（底线发球）
 * ========================= */
const blob_box = {
  court: 'half',
  ballHandler: '3', // 3 号模拟发球队员
  offense: [
    p(0.36, 0.71), // 1
    p(0.64, 0.71), // 2
    p(0.06, 0.92), // 3（发球）
    p(0.4, 0.84), // 4
    p(0.6, 0.84)  // 5
  ],
  defense: [
    p(0.36, 0.59),
    p(0.64, 0.59),
    p(0.12, 0.88),
    p(0.44, 0.78),
    p(0.56, 0.78)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.64, 0.71), p(0.56, 0.78), p(0.52, 0.86), p(0.5, 0.92)] }, // 2 借掩切篮下
    { type: 'pass', pts: [p(0.06, 0.92), p(0.5, 0.92)] }                                // 发球 → 2
  ]
};

/** =========================
 * SLOB Zipper（边线发球）
 * ========================= */
const slob_zipper = {
  court: 'half',
  ballHandler: '3', // 3 号模拟边线发球
  offense: [
    p(0.34, 0.84), // 1
    p(0.24, 0.88), // 2 zipper 起点
    p(0.08, 0.48), // 3（发球）
    p(0.3, 0.67), // 4
    p(0.42, 0.67)  // 5
  ],
  defense: [
    p(0.34, 0.78),
    p(0.26, 0.82),
    p(0.14, 0.44),
    p(0.34, 0.59),
    p(0.44, 0.59)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.24, 0.88), p(0.28, 0.74), p(0.34, 0.52), p(0.42, 0.37)] }, // 2 zipper 上提
    { type: 'pass', pts: [p(0.08, 0.48), p(0.42, 0.37)] }                                // 发球 → 2
  ]
};

/** =========================
 * Zoom Action（侧翼 Zoom）
 * ========================= */
const zoom_action = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.5, 0.37),
    p(0.84, 0.80), // 2 角落上提
    p(0.18, 0.78),
    p(0.68, 0.56), // 4 zoom 掩护
    p(0.56, 0.67)  // 5 DHO 点
  ],
  defense: [
    p(0.5, 0.32),
    p(0.78, 0.74),
    p(0.24, 0.67),
    p(0.64, 0.48),
    p(0.56, 0.56)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.84, 0.80), p(0.76, 0.67), p(0.68, 0.56), p(0.6, 0.44)] }, // 2 借 zoom
    { type: 'run',  pts: [p(0.56, 0.67), p(0.6, 0.56), p(0.62, 0.44)] },                 // 5 到 DHO 点
    { type: 'pass', pts: [p(0.5, 0.37), p(0.62, 0.44)] }                                 // 1 → 5/2 DHO 触发
  ]
};

/** =========================
 * Flex Cut（Flex 切入）
 * ========================= */
const flex_cut = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.56, 0.37),
    p(0.82, 0.74), // 2 baseline cutter
    p(0.24, 0.74), // 3 wing
    p(0.62, 0.82), // 4 flex screener
    p(0.38, 0.63)
  ],
  defense: [
    p(0.56, 0.32),
    p(0.76, 0.67),
    p(0.28, 0.67),
    p(0.58, 0.74),
    p(0.4, 0.56)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.82, 0.74), p(0.7, 0.82), p(0.58, 0.88), p(0.5, 0.90)] }, // 2 flex 切入
    { type: 'pass', pts: [p(0.56, 0.37), p(0.5, 0.90)] }                                 // 1 → 2
  ]
};

/** =========================
 * Delay 5-Out（拖车延迟）
 * ========================= */
const delay_5out = {
  court: 'half',
  ballHandler: '5',
  offense: [
    p(0.5, 0.44), // 1
    p(0.78, 0.52), // 2
    p(0.22, 0.52), // 3
    p(0.84, 0.80), // 4
    p(0.5, 0.37)  // 5 拖车持球
  ],
  defense: [
    p(0.5, 0.34),
    p(0.74, 0.44),
    p(0.26, 0.44),
    p(0.78, 0.71),
    p(0.5, 0.32)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.5, 0.44), p(0.6, 0.44), p(0.68, 0.48)] }, // 1 拉开接应
    { type: 'pass', pts: [p(0.5, 0.37), p(0.68, 0.48)] },                // 5 → 1
    { type: 'pass', pts: [p(0.68, 0.48), p(0.22, 0.52)] }                 // 1 → 3 转移
  ]
};

/** =========================
 * Stack PnR（叠位掩护）
 * ========================= */
const stack_pnr = {
  court: 'half',
  ballHandler: '1',
  offense: [
    p(0.5, 0.37), // 1
    p(0.18, 0.80), // 2
    p(0.82, 0.80), // 3
    p(0.56, 0.67), // 4 stack 上层
    p(0.56, 0.80)  // 5 stack 下层
  ],
  defense: [
    p(0.5, 0.32),
    p(0.24, 0.74),
    p(0.76, 0.74),
    p(0.54, 0.56),
    p(0.56, 0.71)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.5, 0.37), p(0.56, 0.34), p(0.62, 0.37)] }, // 1 借 stack
    { type: 'run',  pts: [p(0.56, 0.67), p(0.64, 0.56), p(0.72, 0.48)] }, // 4 外弹
    { type: 'run',  pts: [p(0.56, 0.80), p(0.54, 0.86), p(0.52, 0.92)] }, // 5 顺下
    { type: 'pass', pts: [p(0.62, 0.37), p(0.52, 0.92)] }                 // 1 → 5
  ]
};

/** =========================
 * BLOB Lob（底线空接）
 * ========================= */
const blob_lob = {
  court: 'half',
  ballHandler: '4',
  offense: [
    p(0.34, 0.78), // 1
    p(0.66, 0.78), // 2
    p(0.5, 0.84), // 3 终结点
    p(0.06, 0.92), // 4 发球
    p(0.5, 0.67)  // 5 掩护
  ],
  defense: [
    p(0.34, 0.67),
    p(0.66, 0.67),
    p(0.5, 0.78),
    p(0.12, 0.88),
    p(0.5, 0.56)
  ],
  shapes: [
    { type: 'run',  pts: [p(0.5, 0.84), p(0.46, 0.80), p(0.48, 0.67), p(0.5, 0.52)] }, // 3 反跑空接
    { type: 'pass', pts: [p(0.06, 0.92), p(0.5, 0.52)] }                                 // 4 → 3
  ]
};

/** =========================
 * SLOB Hammer（边线 Hammer）
 * ========================= */
const slob_hammer = {
  court: 'half',
  ballHandler: '3',
  offense: [
    p(0.08, 0.48), // 3 发球
    p(0.4, 0.41), // 1 接球突破
    p(0.84, 0.82), // 2 底角
    p(0.66, 0.74), // 4 hammer 掩护
    p(0.52, 0.63)  // 5
  ],
  defense: [
    p(0.14, 0.44),
    p(0.4, 0.33),
    p(0.78, 0.74),
    p(0.62, 0.67),
    p(0.52, 0.52)
  ],
  shapes: [
    { type: 'pass', pts: [p(0.08, 0.48), p(0.4, 0.41)] },                                 // 3 → 1
    { type: 'run',  pts: [p(0.4, 0.41), p(0.56, 0.52), p(0.72, 0.67), p(0.84, 0.71)] },    // 1 底线突破
    { type: 'run',  pts: [p(0.66, 0.74), p(0.76, 0.80), p(0.82, 0.82)] },                   // 4 去设 hammer
    { type: 'pass', pts: [p(0.84, 0.71), p(0.84, 0.82)] }                                  // 1 → 2
  ]
};

// —— 预设集合 ——
// （命名用 id 字符串，与你的 pages / 库对齐）
const PRESETS = {
  fiveOut,
  horns_L,
  spain,
  double_drag,
  ghost,
  floppy,
  pistol,
  chicago,
  elevator,
  hammer,
  princeton,
  blob_box,
  slob_zipper,
  zoom_action,
  flex_cut,
  delay_5out,
  stack_pnr,
  blob_lob,
  slob_hammer,
  horns_flare_L
};

// —— 取预设（含镜像兜底）——
export function getPreset(id) {
  if (!id) return null;
  if (id === 'horns_R')           return mirrorX(horns_L);
  if (id === 'horns_flare_R')     return mirrorX(horns_flare_L);
  return PRESETS[id] || null;
}

export { PRESETS, mirrorX };
